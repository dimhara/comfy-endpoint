
# ==========================================
# DOCKERFILE.BAKED
# Inherits from the base image and pulls models
# ==========================================
FROM ghcr.io/dimhara/comfy-endpoint:latest

# Define the model mapping for the Qwen setup.
# Format: RepoID:RemoteFile:TargetDir[:LocalRename]
ARG MODELS="unsloth/Qwen-Image-Edit-2511-GGUF:qwen-image-edit-2511-Q4_K_M.gguf:models/unet,\
unsloth/Qwen2.5-VL-7B-Instruct-GGUF:Qwen2.5-VL-7B-Instruct-UD-Q4_K_XL.gguf:models/text_encoders,\
Comfy-Org/Qwen-Image_ComfyUI:split_files/vae/qwen_image_vae.safetensors:models/vae:qwen_image_vae.safetensors,\
lightx2v/Qwen-Image-Edit-2511-Lightning:Qwen-Image-Edit-2511-Lightning-4steps-V1.0-bf16.safetensors:models/loras,\
unsloth/Qwen2.5-VL-7B-Instruct-GGUF:mmproj-BF16.gguf:models/text_encoders:Qwen2.5-VL-7B-Instruct-mmproj-BF16.gguf"

# Set environment variable so utils.py can see it during build
ENV MODELS=$MODELS

WORKDIR /ComfyUI

# Run the model downloader/renamer
# This creates a new layer with all the model files included.
RUN python3 utils.py

# Clean up the HF cache within this layer to save space, 
# since we've already copied the files to their ComfyUI destinations.
RUN rm -rf /root/.cache/huggingface

# Inherits CMD ["/start.sh"] from the base image

